
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swostik Construction - PO System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<!-- Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body class="bg-gray-100 p-6">

<div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl p-6">

<!-- HEADER -->
<div class="flex gap-4 mb-6">
  <img src="logo.jpg" class="w-20 h-20 object-contain rounded-full">
  <div>
    <h1 class="text-2xl font-bold text-red-600">Swostik Construction</h1>
    <p class="text-gray-500">Vendor Order / Purchase Order System</p>
  </div>
</div>

<!-- FORM -->
<div class="grid grid-cols-1 md:grid-cols-7 gap-3">

  <!-- Vendor autocomplete -->
  <input id="vendor" list="vendorList" class="border p-2 rounded" placeholder="Vendor Name">
  <datalist id="vendorList"></datalist>

  <select id="site" class="border p-2 rounded">
    <option value="">Select Site</option>
    <option>Pepsicola Site</option>
    <option>Thimi Site</option>
    <option>Budhanilkantha Site</option>
    <option>Banepa Site</option>
  </select>

  <input id="product" class="border p-2 rounded" placeholder="Product">
  <input id="quantity" type="number" class="border p-2 rounded" placeholder="Qty">
  <input id="price" type="number" class="border p-2 rounded" placeholder="Price">
  <input id="orderedBy" class="border p-2 rounded" placeholder="Ordered By">

  <select id="status" class="border p-2 rounded">
    <option>Pending</option>
    <option>Approved</option>
  </select>
</div>

<button onclick="addOrder()" class="mt-4 bg-red-600 text-white px-6 py-2 rounded">
Add Order
</button>

<!-- ORDER TABLE -->
<div class="overflow-x-auto mt-6">
<table id="orderTable" class="w-full text-sm border">
<thead class="bg-gray-200">
<tr>
<th class="border p-2">SN</th>
<th class="border p-2">AD Date</th>
<th class="border p-2">BS Date</th>
<th class="border p-2">Vendor</th>
<th class="border p-2">Site</th>
<th class="border p-2">Product</th>
<th class="border p-2">Qty</th>
<th class="border p-2">Price</th>
<th class="border p-2">Total</th>
<th class="border p-2">Ordered By</th>
<th class="border p-2">Status</th>
<th class="border p-2">Bill</th>
<th class="border p-2">Delete</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<!-- SITE SUMMARY -->
<h2 class="text-lg font-bold mt-8 mb-2 text-red-600">Site-Wise Summary</h2>
<table class="w-full text-sm border">
<thead class="bg-gray-200">
<tr>
<th class="border p-2">Site</th>
<th class="border p-2">Total Amount</th>
</tr>
</thead>
<tbody id="siteSummary"></tbody>
</table>

<!-- BUTTONS -->
<div class="flex gap-4 mt-6">
<button onclick="exportPDF()" class="bg-red-600 text-white px-4 py-2 rounded">Export PDF</button>
<button onclick="exportExcel()" class="bg-green-600 text-white px-4 py-2 rounded">Export Excel</button>
<button onclick="window.print()" class="bg-gray-700 text-white px-4 py-2 rounded">Print</button>
</div>

</div>

<script>
/* ---------------- NEPALI DATE (BS) ---------------- */
function getNepaliDate() {
  const d = new Date();
  let bsYear = d.getFullYear() + 56;
  let bsMonth = d.getMonth() + 9;
  let bsDay = d.getDate();

  if (bsMonth > 12) {
    bsMonth -= 12;
    bsYear += 1;
  }
  return `${bsYear}-${String(bsMonth).padStart(2,'0')}-${String(bsDay).padStart(2,'0')}`;
}

/* ---------------- DATA ---------------- */
let orders = JSON.parse(localStorage.getItem('orders')) || [];
let sn = orders.length ? Math.max(...orders.map(o => o.sn)) + 1 : 1;

const vendorEl = document.getElementById('vendor');
const siteEl = document.getElementById('site');
const productEl = document.getElementById('product');
const quantityEl = document.getElementById('quantity');
const priceEl = document.getElementById('price');
const orderedByEl = document.getElementById('orderedBy');
const statusEl = document.getElementById('status');

/* ---------------- RENDER ---------------- */
function renderTable() {
  const tbody = document.querySelector('#orderTable tbody');
  tbody.innerHTML = '';

  orders.forEach(o => {
    tbody.innerHTML += `
    <tr>
      <td class="border p-2">${o.sn}</td>
      <td class="border p-2">${o.adDate}</td>
      <td class="border p-2">${o.bsDate}</td>
      <td class="border p-2">${o.vendor}</td>
      <td class="border p-2">${o.site}</td>
      <td class="border p-2">${o.product}</td>
      <td class="border p-2">${o.qty}</td>
      <td class="border p-2">${o.price}</td>
      <td class="border p-2">${o.total}</td>
      <td class="border p-2">${o.orderedBy}</td>
      <td class="border p-2">${o.status}</td>
      <td class="border p-2 text-center">
        <button onclick="downloadBill(${o.sn})" class="bg-blue-600 text-white px-2 py-1 text-xs rounded">Bill</button>
      </td>
      <td class="border p-2 text-center">
        <button onclick="deleteOrder(${o.sn})" class="bg-red-600 text-white px-2 py-1 text-xs rounded">X</button>
      </td>
    </tr>`;
  });

  renderVendorList();
  renderSiteSummary();
}

renderTable();

/* ---------------- ADD ORDER ---------------- */
function addOrder() {
  if (!vendorEl.value || !siteEl.value || !productEl.value || !quantityEl.value || !priceEl.value) {
    alert('Fill all fields');
    return;
  }

  const now = new Date();

  orders.push({
    sn: sn++,
    adDate: now.toLocaleDateString(),
    bsDate: getNepaliDate(),
    vendor: vendorEl.value,
    site: siteEl.value,
    product: productEl.value,
    qty: quantityEl.value,
    price: priceEl.value,
    total: quantityEl.value * priceEl.value,
    orderedBy: orderedByEl.value,
    status: statusEl.value
  });

  localStorage.setItem('orders', JSON.stringify(orders));
  renderTable();

  vendorEl.value = productEl.value = quantityEl.value = priceEl.value = orderedByEl.value = '';
}

/* ---------------- DELETE ---------------- */
function deleteOrder(sn) {
  if (!confirm('Delete order?')) return;
  orders = orders.filter(o => o.sn !== sn);
  localStorage.setItem('orders', JSON.stringify(orders));
  renderTable();
}

/* ---------------- BILL PDF ---------------- */
function downloadBill(sn) {
  const o = orders.find(x => x.sn === sn);
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text('Swostik Construction - Vendor Bill', 14, 20);
  doc.autoTable({
    startY: 30,
    body: [
      ['Bill No', o.sn],
      ['AD Date', o.adDate],
      ['BS Date', o.bsDate],
      ['Vendor', o.vendor],
      ['Site', o.site],
      ['Product', o.product],
      ['Qty', o.qty],
      ['Rate', o.price],
      ['Total', o.total]
    ]
  });

  doc.save(`Bill-${o.sn}.pdf`);
}

/* ---------------- VENDOR AUTOCOMPLETE ---------------- */
function renderVendorList() {
  const list = document.getElementById('vendorList');
  const vendors = [...new Set(orders.map(o => o.vendor))];
  list.innerHTML = vendors.map(v => `<option value="${v}">`).join('');
}

/* ---------------- SITE SUMMARY ---------------- */
function renderSiteSummary() {
  const summary = {};
  orders.forEach(o => {
    summary[o.site] = (summary[o.site] || 0) + Number(o.total);
  });

  const tbody = document.getElementById('siteSummary');
  tbody.innerHTML = '';
  Object.keys(summary).forEach(site => {
    tbody.innerHTML += `
    <tr>
      <td class="border p-2">${site}</td>
      <td class="border p-2 font-bold">${summary[site]}</td>
    </tr>`;
  });
}

/* ---------------- EXPORTS ---------------- */
function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('l');
  doc.text('Swostik Construction - Orders', 14, 15);
  doc.autoTable({ html: '#orderTable', startY: 25 });
  doc.save('Orders.pdf');
}

function exportExcel() {
  const table = document.getElementById('orderTable').cloneNode(true);
  table.querySelectorAll('button').forEach(b => b.remove());
  const wb = XLSX.utils.table_to_book(table, { sheet: 'Orders' });
  XLSX.writeFile(wb, 'Orders.xlsx');
}
</script>

</body>
</html>

